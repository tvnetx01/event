<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Netxtv</title>

<style>
/* ================= GLOBAL ================= */
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,Tahoma}
html,body{min-height:100%}
body{
  background:linear-gradient(135deg,#1a2a6c,#b21f1f,#fdbb2d);
  background-attachment:fixed;
  color:#fff;
  padding:20px;
}

.container{max-width:1100px;margin:auto}

/* ================= LOADING ================= */
.loading-screen{
  position:fixed;
  inset:0;
  z-index:9999;
  background:linear-gradient(135deg,#1a2a6c,#b21f1f,#fdbb2d);
  display:flex;
  align-items:center;
  justify-content:center;
  transition:.5s;
}
.loading-screen.hide{opacity:0;visibility:hidden}
.spinner{
  width:70px;height:70px;
  border:6px solid rgba(255,255,255,.25);
  border-top:6px solid #fff;
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* ================= HEADER ================= */
.league-title{text-align:center;font-size:1.6rem;margin:15px 0}

/* ================= SEARCH & FILTER ================= */
.search-box{text-align:center;margin-bottom:12px}
.search-box input{
  max-width:420px;width:100%;
  padding:10px;border-radius:25px;border:none
}
.filters{display:flex;gap:10px;justify-content:center;margin-bottom:15px}
.filters button{
  padding:7px 16px;border:none;border-radius:20px;
  background:rgba(255,255,255,.2);
  color:#fff;font-weight:bold;cursor:pointer
}
.filters button.active{background:#ff9800}

/* ================= MATCH CARD ================= */
.match-container{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(350px,1fr));
  gap:12px
}
.match-card{
  background:rgba(255,255,255,.12);
  border-radius:10px;
  padding:16px
}
.match-time{text-align:center;color:#ffcc00;font-weight:bold}

/* LIVE BAR */
.live-bar{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  font-weight:bold;
  color:#00ff6a;
  margin-bottom:6px;
  animation:pulse 1.2s infinite;
}
.live-dot{
  width:10px;height:10px;
  background:#00ff6a;
  border-radius:50%;
}
@keyframes pulse{
  0%{opacity:1}
  50%{opacity:.5}
  100%{opacity:1}
}

.team-info{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:10px 0
}
.team{text-align:center;width:40%}
.team img{
  width:60px;height:60px;
  background:#fff;border-radius:50%;padding:5px
}
.vs{font-weight:bold;color:#ffcc00}
.score{text-align:center;color:#ffcc00;font-size:1.4rem}

.stream-links{text-align:center;margin-top:10px}
.stream-link{
  background:linear-gradient(to right,#ff5722,#ff9800);
  padding:8px 18px;border-radius:25px;
  color:#fff;text-decoration:none;font-weight:bold
}

.loading,.error,.no-matches{text-align:center;padding:30px}
.hidden{display:none}
</style>
</head>

<body>

<!-- LOADING -->
<div id="loadingScreen" class="loading-screen">
  <div>
    <div class="spinner"></div>
    <div style="margin-top:15px;font-weight:bold">Sabar... lagi loading ‚öΩüèÄ</div>
  </div>
</div>

<div class="container">
  <h2 id="league-title" class="league-title"></h2>

  <div id="searchBox" class="search-box">
    <input id="search" placeholder="Cari tim atau liga...">
  </div>

  <div id="filterBox" class="filters">
    <button data-type="all" class="active">ALL</button>
    <button data-type="1">FOOTBALL</button>
    <button data-type="2">NBA</button>
  </div>

  <div id="matches" class="match-container"></div>
</div>

<footer id="footer" style="text-align:center;margin-top:30px;opacity:.8"></footer>

<script>
let CFG, allMatches=[], activeFilter='all';

/* ===== CONFIG ===== */
async function loadConfig(){
  CFG = await (await fetch('https://pisionx.pages.dev/api/tigoals.js')).json();
}

/* ===== UTIL ===== */
const qs = n => new URLSearchParams(location.search).get(n);
const hasParam = () => location.search.length > 1;

/* ===== LIVE TIME CALC ===== */
function calcLiveMinute(m){
  if(!m.matchTime_t) return '';
  const start = new Date(m.matchTime_t).getTime();
  const now = Date.now();
  let min = Math.floor((now - start) / 60000);
  if(min < 1) min = 1;

  if(m.injuryTime){
    return `${min}+${m.injuryTime}'`;
  }
  return `${min}'`;
}

/* ===== MATCH TIME LABEL ===== */
function renderMatchTime(m){
  if(m.state === 1){
    return `‚è± ${calcLiveMinute(m)}`;
  }

  if(m.state === 0){
    return `‚è≥ ${new Date(m.matchTime_t).toLocaleString('id-ID',{
      timeZone: CFG.displaySettings.timezone,
      day:'2-digit',month:'short',
      hour:'2-digit',minute:'2-digit'
    })}`;
  }

  return '‚úÖ FT';
}

/* ===== LOGO ===== */
function logoUrl(url){
  if(!url) return CFG.logoUrlMapping.fallback;

  if(url.startsWith(CFG.logoUrlMapping.soccerSource)){
    const p = url.replace(CFG.logoUrlMapping.soccerSource,'');
    return `https://tg.selina36.workers.dev/${CFG.logoUrlMapping.soccerCdn}${p}`;
  }

  if(url.startsWith(CFG.logoUrlMapping.nbaSource)){
    const p = url.replace(CFG.logoUrlMapping.nbaSource,'').replace(/\.png$/i,'.jpg');
    return `https://tg.selina36.workers.dev/${CFG.logoUrlMapping.nbaCdn}${p}`;
  }

  return CFG.logoUrlMapping.fallback;
}

/* ===== RENDER ===== */
function render(){
  const box = document.getElementById('matches');
  const q = document.getElementById('search').value.toLowerCase();
  box.innerHTML = '';

  let list = [...allMatches];

  if(!hasParam()){
    if(activeFilter !== 'all'){
      list = list.filter(m => m.matchType == activeFilter);
    }
    if(q){
      list = list.filter(m =>
        m.homeName.toLowerCase().includes(q) ||
        m.awayName.toLowerCase().includes(q) ||
        (m.leagueEn || '').toLowerCase().includes(q)
      );
    }
  }

  if(!list.length){
    box.innerHTML = `<div class="no-matches">Tidak ada pertandingan</div>`;
    return;
  }

  const counter = {};
  const go = qs('go');

  list.forEach(m=>{
    counter[m.matchType] = (counter[m.matchType] || 0) + 1;
    const i = counter[m.matchType];

    let stream;
    if(go) stream = `${go}${i}`;
    else if(m.matchType == 2) stream = `nba${i}`;
    else if(m.matchType == 1) stream = `s808${i}`;
    else stream = `${i}`;

    const c = document.createElement('div');
    c.className = 'match-card';
    c.innerHTML = `
      ${m.state === 1 ? `<div class="live-bar"><div class="live-dot"></div>LIVE</div>` : ''}

      <div class="match-time">${renderMatchTime(m)}</div>

      <div class="team-info">
        <div class="team">
          <img src="${logoUrl(m.homeLogoUrl)}">
          <div>${m.homeName}</div>
        </div>

        <div class="vs">VS</div>

        <div class="team">
          <img src="${logoUrl(m.awayLogoUrl)}">
          <div>${m.awayName}</div>
        </div>
      </div>

      ${m.state !== 0 ? `<div class="score">${m.homeScore}-${m.awayScore}</div>` : ''}

      <div class="stream-links">
        <a class="stream-link" href="go:${stream}">WATCH NOW üì∫</a>
      </div>
    `;
    box.appendChild(c);
  });
}

/* ===== INIT ===== */
(async()=>{
  await loadConfig();

  document.title = CFG.branding.siteTitle;
  document.getElementById('footer').textContent = CFG.branding.footerText;

  let list = (await (await fetch(CFG.apiUrls.matchSchedule)).json()).matchList || [];

  const id = qs('id'), type = qs('type');
  if(id){
    list = list.filter(x => x.leagueId == id);
    document.getElementById('league-title').textContent = list[0]?.leagueEn || '';
  }
  if(type){
    list = list.filter(x => x.matchType == type);
  }

  allMatches = list;

  if(hasParam()){
    searchBox.classList.add('hidden');
    filterBox.classList.add('hidden');
  }

  render();
  document.getElementById('search').oninput = render;

  document.querySelectorAll('.filters button').forEach(b=>{
    b.onclick = ()=>{
      document.querySelectorAll('.filters button').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      activeFilter = b.dataset.type;
      render();
    };
  });

  setTimeout(()=>loadingScreen.classList.add('hide'),300);

  /* AUTO UPDATE LIVE TIME */
  setInterval(render, 30000);
})();
</script>

</body>
</html>
