<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Netxtv</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,Tahoma}
body{background:linear-gradient(135deg,#1a2a6c,#b21f1f,#fdbb2d);color:#fff;padding:20px}
.container{max-width:1000px;margin:auto}
.league-title{text-align:center;font-size:1.6rem;margin:20px 0}
.match-container{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:12px}
.match-card{background:rgba(255,255,255,.12);border-radius:10px;padding:18px}
.match-time{text-align:center;color:#ffcc00;font-weight:bold}
.team-info{display:flex;justify-content:space-between;align-items:center;margin:10px 0}
.team{text-align:center;width:40%}
.team img{width:60px;height:60px;background:#fff;border-radius:50%;padding:5px}
.vs{font-weight:bold;color:#ffcc00}
.score{text-align:center;color:#ffcc00;font-size:1.4rem}
.stream-links{text-align:center;margin-top:10px}
.stream-link{background:linear-gradient(to right,#ff5722,#ff9800);padding:8px 18px;border-radius:25px;color:#fff;text-decoration:none;font-weight:bold}
.loading,.error,.no-matches{text-align:center;padding:30px}
@media(max-width:768px){.match-container{grid-template-columns:1fr}}
</style>
</head>

<body>
<div class="container">
  <h2 id="league-title" class="league-title"></h2>
  <div id="matches" class="match-container"></div>
</div>

<footer id="footer" style="text-align:center;margin-top:30px;opacity:.8"></footer>

<script>
/* ================= LOAD CONFIG ================= */
let CFG;
let currentWorker;

async function loadConfig(){
  const r = await fetch('https://pisionx.pages.dev/api/tigoals.js');
  CFG = await r.json();
}

/* ================= WORKER ================= */
function randomWorker(tried=[]){
  let w;
  do{
    w=Math.floor(Math.random()*CFG.proxyDomains.maxRange)+1;
  }while(CFG.proxyDomains.skip.includes(w)||tried.includes(w));
  return w;
}
function proxyUrl(w,path){
  return `${CFG.proxyDomains.prefix}${w}${CFG.proxyDomains.suffix}${path}`;
}

/* ================= LOGO ================= */
function logoUrl(url){
  if(!url) return CFG.logoUrlMapping.fallback;

  if(url.startsWith(CFG.logoUrlMapping.soccerSource)){
    const p=url.replace(CFG.logoUrlMapping.soccerSource,'');
    return proxyUrl(currentWorker,`/${CFG.logoUrlMapping.soccerCdn}${p}`);
  }

  if(url.startsWith(CFG.logoUrlMapping.nbaSource)){
    const p=url.replace(CFG.logoUrlMapping.nbaSource,'').replace(/\.png$/i,'.jpg');
    return proxyUrl(currentWorker,`/${CFG.logoUrlMapping.nbaCdn}${p}`);
  }

  return CFG.logoUrlMapping.fallback;
}

function retry(img,original,tried=[]){
  tried.push(currentWorker);
  if(tried.length>=CFG.proxyDomains.maxRange){
    img.src=CFG.logoUrlMapping.fallback;return;
  }
  currentWorker=randomWorker(tried);
  img.onerror=()=>retry(img,original,tried);
  img.src=logoUrl(original);
}

/* ================= UTIL ================= */
const qs=n=>new URLSearchParams(location.search).get(n);
const time=t=>new Date(t).toLocaleString('id-ID',{timeZone:CFG.displaySettings.timezone,hour:'2-digit',minute:'2-digit'});
const status=m=>m.state===1?'LIVE':m.state===2?'SELESAI':'AKAN DATANG';

/* ================= MAIN ================= */
async function loadMatches(){
  const box=document.getElementById('matches');
  const title=document.getElementById('league-title');
  box.innerHTML=`<div class="loading">${CFG.branding.loadingMessage}</div>`;

  try{
    const r=await fetch(CFG.apiUrls.matchSchedule);
    let list=(await r.json()).matchList||[];

    const id=qs('id'), type=qs('type'), go=qs('go');

    if(id){ list=list.filter(x=>x.leagueId==id); title.textContent=list[0]?.leagueEn||''; }
    else title.textContent='';

    if(type){ list=list.filter(x=>x.matchType==type); }

    box.innerHTML='';
    if(!list.length){ box.innerHTML='<div class="no-matches">Tidak ada pertandingan</div>'; return; }

    const counter={};

    list.forEach(m=>{
      counter[m.matchType]=(counter[m.matchType]||0)+1;
      const i=counter[m.matchType];

      let stream;
      if(go) stream=`${go}${id?i:''}`;
      else if(m.matchType==2) stream=`nba${i}`;
      else if(m.matchType==1) stream=`s808${i}`;
      else stream=`${i}`;

      const c=document.createElement('div');
      c.className='match-card';
      c.innerHTML=`
        <div>${status(m)}</div>
        <div class="match-time">${time(m.matchTime_t)}</div>

        <div class="team-info">
          <div class="team">
            <img src="${logoUrl(m.homeLogoUrl)}" onerror="retry(this,'${m.homeLogoUrl}')">
            <div>${m.homeName}</div>
          </div>

          <div class="vs">VS</div>

          <div class="team">
            <img src="${logoUrl(m.awayLogoUrl)}" onerror="retry(this,'${m.awayLogoUrl}')">
            <div>${m.awayName}</div>
          </div>
        </div>

        ${m.state!==0?`<div class="score">${m.homeScore}-${m.awayScore}</div>`:''}

        <div class="stream-links">
          <a class="stream-link" href="go:${stream}">WATCH NOW ðŸ“º</a>
        </div>
      `;
      box.appendChild(c);
    });

  }catch(e){
    box.innerHTML=`<div class="error">${CFG.branding.errorMessage}</div>`;
  }
}

/* ================= INIT ================= */
(async()=>{
  await loadConfig();
  currentWorker=randomWorker();
  document.title=CFG.branding.siteTitle;
  document.getElementById('footer').textContent=CFG.branding.footerText;
  loadMatches();
})();
</script>
</body>
</html>
